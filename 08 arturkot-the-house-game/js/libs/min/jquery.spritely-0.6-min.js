/*
 * jQuery spritely 0.6
 * http://spritely.net/
 *
 * Documentation:
 * http://spritely.net/documentation/
 *
 * Copyright 2010-2011, Peter Chater, Artlogic Media Ltd, http://www.artlogic.net/
 * Dual licensed under the MIT or GPL Version 2 licenses.
 *
 * Change history:
 * Version 0.6
 *   - added events to the .sprite() method: on_first_frame, on_last_frame, on_frame:
 *     $('#sprite').sprite({
 *         fps: 9, 
 *         no_of_frames: 24, 
 *         on_first_frame: function(obj) {
 *             obj.spState(1); // change to state 1 (first row) on frame 1
 *         }, 
 *         on_last_frame: function(obj) {
 *             obj.spStop(); // stop the animation on the last frame
 *         },
 *         on_frame: {
 *             8: function(obj) {
 *                 obj.spState(2); // change to state 2 (row 2) on frame 8
 *             },
 *             16: function(obj) {
 *                 obj.spState(3); // change to state 3 (row 3) on frame 16
 *             }
 *         }
 *     });
 *   - added start_at_frame: $('#sprite').sprite({fps: 9, no_of_frames: 24, start_at_frame: 8});
 * Version 0.5
 *   - added a 'destroy()' method which will stop the element's sprite behaviour, without actually removing the element. Example: $('#my_sprite').destroy()
 * Version 0.4
 *   - add up/down for 'pan' method. <ricky.hewitt@artlogic.net>
 *   - added 'dir' option for Sprites. This means a Sprite can be played in reverse.
 *   - removed alert message regarding jQuery.draggable (now uses console.log, if available) <ricky.hewitt@artlogic.net>
 * Version 0.3b
 *   - added lockTo method for locking sprites to background images. $('#sprite').lockTo('#background, {'left': 380, 'top': -60, 'bg_img_width': 1110});
 * Version 0.2.1
 *   - animate function will stop cycling after play_frames has completed
 * Version 0.2 beta
 *   - added isDraggable method (requires jquery-ui) $('#sprite').sprite().isDraggable({start: null, stop: function() {alert('Ouch! You dropped me!')});
 *   - sprites may be set to play a limited number of frames when instantiated, e.g. $('#sprite').sprite({fps: 9, no_of_frames: 3, play_frames: 30})
 *   - sprite speed may be controlled at any point by setting the frames-per-second $('#sprite').fps(20);
 *   - sprites with multiple rows of frames may have there 'state' changed, e.g. to make the second row of frames
 *     active, use: $('#sprite').spState(2); - to return to the first row, use $('#sprite').spState(1);
 *   - background element speed may be controlled at any point with .spSpeed(), e.g. $('#bg1').spSpeed(10)
 *   - background elements may be set to a depth where 100 is the viewer (up close) and 0 is the horizon, e.g.:
 *     $('#bg1').pan({fps: 30, speed: 2, dir: 'left', depth: 30});
 *     $('#bg2').pan({fps: 30, speed: 3, dir: 'left', depth: 70});
 *     relative speed of backgrounds may now be set in a single action with $('#bg1, #bg2').spRelSpeed(20);
 *     which will make elements closer to the horizon (lower depths) move slower than closer elements (higher depths)
 */(function(a){a._spritely={animate:function(b){var c=a("#"+a(b.el).attr("id")),d=c.attr("id");if(!a._spritely.instances[d])return this;b=a.extend(b,a._spritely.instances[d]||{});b.play_frames&&!a._spritely.instances[d].remaining_frames&&(a._spritely.instances[d].remaining_frames=b.play_frames+1);if(b.type=="sprite"&&b.fps){var e,f=function(c){var f=b.width,g=b.height;if(!e){e=[];total=0;for(var h=0;h<b.no_of_frames;h++){e[e.length]=0-total;total+=f}}a._spritely.instances[d]["current_frame"]==0?b.on_first_frame&&b.on_first_frame(c):a._spritely.instances[d]["current_frame"]==e.length-1&&b.on_last_frame&&b.on_last_frame(c);b.on_frame&&b.on_frame[a._spritely.instances[d].current_frame]&&b.on_frame[a._spritely.instances[d].current_frame](c);b.rewind==1?a._spritely.instances[d].current_frame<=0?a._spritely.instances[d].current_frame=e.length-1:a._spritely.instances[d].current_frame=a._spritely.instances[d].current_frame-1:a._spritely.instances[d].current_frame>=e.length-1?a._spritely.instances[d].current_frame=0:a._spritely.instances[d].current_frame=a._spritely.instances[d].current_frame+1;var i=a._spritely.getBgY(c);c.css("background-position",e[a._spritely.instances[d].current_frame]+"px "+i);if(b.bounce&&b.bounce[0]>0&&b.bounce[1]>0){var j=b.bounce[0],k=b.bounce[1],l=b.bounce[2];c.animate({top:"+="+j+"px",left:"-="+k+"px"},l).animate({top:"-="+j+"px",left:"+="+k+"px"},l)}};if(a._spritely.instances[d].remaining_frames&&a._spritely.instances[d].remaining_frames>0){a._spritely.instances[d].remaining_frames--;if(a._spritely.instances[d]["remaining_frames"]==0){a._spritely.instances[d].remaining_frames=-1;delete a._spritely.instances[d].remaining_frames;return}f(c)}else a._spritely.instances[d]["remaining_frames"]!=-1&&f(c)}else if(b.type=="pan"&&!a._spritely.instances[d]._stopped){if(b.dir=="up"){a._spritely.instances[d].l=a._spritely.getBgX(c).replace("px","");a._spritely.instances[d].t=a._spritely.instances[d].t-(b.speed||1)||0}else if(b.dir=="down"){a._spritely.instances[d].l=a._spritely.getBgX(c).replace("px","");a._spritely.instances[d].t=a._spritely.instances[d].t+(b.speed||1)||0}else if(b.dir=="left"){a._spritely.instances[d].l=a._spritely.instances[d].l-(b.speed||1)||0;a._spritely.instances[d].t=a._spritely.getBgY(c).replace("px","")}else{a._spritely.instances[d].l=a._spritely.instances[d].l+(b.speed||1)||0;a._spritely.instances[d].t=a._spritely.getBgY(c).replace("px","")}var g=a._spritely.instances[d].l.toString();g.indexOf("%")==-1?g+="px ":g+=" ";var h=a._spritely.instances[d].t.toString();h.indexOf("%")==-1?h+="px ":h+=" ";a(c).css("background-position",g+h)}a._spritely.instances[d].options=b;window.setTimeout(function(){a._spritely.animate(b)},parseInt(1e3/b.fps))},randomIntBetween:function(a,b){return parseInt(rand_no=Math.floor((b-(a-1))*Math.random())+a)},getBgY:function(b){if(a.browser.msie)var c=a(b).css("background-position-y")||"0";else var c=(a(b).css("background-position")||" ").split(" ")[1];return c},getBgX:function(b){if(a.browser.msie)var c=a(b).css("background-position-x")||"0";else var c=(a(b).css("background-position")||" ").split(" ")[0];return c},get_rel_pos:function(a,b){var c=a;if(a<0)while(c<0)c+=b;else while(c>b)c-=b;return c}};a.fn.extend({spritely:function(b){var b=a.extend({type:"sprite",do_once:!1,width:null,height:null,fps:12,no_of_frames:2,stop_after:null},b||{}),c=a(this).attr("id");a._spritely.instances||(a._spritely.instances={});a._spritely.instances[c]||(b.start_at_frame?a._spritely.instances[c]={current_frame:b.start_at_frame-1}:a._spritely.instances[c]={current_frame:-1});a._spritely.instances[c].type=b.type;a._spritely.instances[c].depth=b.depth;b.el=this;b.width=b.width||a(this).width()||100;b.height=b.height||a(this).height()||100;var d=function(){return parseInt(1e3/b.fps)};b.do_once?a._spritely.animate(b):window.setTimeout(function(){a._spritely.animate(b)},d(b.fps));return this},sprite:function(b){var b=a.extend({type:"sprite",bounce:[0,0,1e3]},b||{});return a(this).spritely(b)},pan:function(b){var b=a.extend({type:"pan",dir:"left",continuous:!0,speed:1},b||{});return a(this).spritely(b)},flyToTap:function(b){var b=a.extend({el_to_move:null,type:"moveToTap",ms:1e3,do_once:!0},b||{});b.el_to_move&&a(b.el_to_move).active();a._spritely.activeSprite&&(window.Touch?a(this)[0].ontouchstart=function(b){var c=a._spritely.activeSprite,d=b.touches[0],e=d.pageY-c.height()/2,f=d.pageX-c.width()/2;c.animate({top:e+"px",left:f+"px"},1e3)}:a(this).click(function(b){var c=a._spritely.activeSprite;a(c).stop(!0);var d=c.width(),e=c.height(),f=b.pageX-d/2,g=b.pageY-e/2;c.animate({top:g+"px",left:f+"px"},1e3)}));return this},isDraggable:function(b){if(!a(this).draggable)return this;var b=a.extend({type:"isDraggable",start:null,stop:null,drag:null},b||{}),c=a(this).attr("id");if(!a._spritely.instances[c])return this;a._spritely.instances[c].isDraggableOptions=b;a(this).draggable({start:function(){var b=a(this).attr("id");a._spritely.instances[b].stop_random=!0;a(this).stop(!0);a._spritely.instances[b].isDraggableOptions.start&&a._spritely.instances[b].isDraggableOptions.start(this)},drag:b.drag,stop:function(){var b=a(this).attr("id");a._spritely.instances[b].stop_random=!1;a._spritely.instances[b].isDraggableOptions.stop&&a._spritely.instances[b].isDraggableOptions.stop(this)}});return this},active:function(){a._spritely.activeSprite=this;return this},activeOnClick:function(){var b=a(this);window.Touch?b[0].ontouchstart=function(c){a._spritely.activeSprite=b}:b.click(function(c){a._spritely.activeSprite=b});return this},spRandom:function(b){var b=a.extend({top:50,left:50,right:290,bottom:320,speed:4e3,pause:0},b||{}),c=a(this).attr("id");if(!a._spritely.instances[c])return this;if(!a._spritely.instances[c].stop_random){var d=a._spritely.randomIntBetween,e=d(b.top,b.bottom),f=d(b.left,b.right);a("#"+c).animate({top:e+"px",left:f+"px"},b.speed)}window.setTimeout(function(){a("#"+c).spRandom(b)},b.speed+b.pause);return this},makeAbsolute:function(){return this.each(function(){var b=a(this),c=b.position();b.css({position:"absolute",marginLeft:0,marginTop:0,top:c.top,left:c.left}).remove().appendTo("body")})},spSet:function(b,c){var d=a(this).attr("id");a._spritely.instances[d][b]=c;return this},spGet:function(b,c){var d=a(this).attr("id");return a._spritely.instances[d][b]},spStop:function(b){a(this).each(function(){var c=a(this).attr("id");a._spritely.instances[c]._last_fps=a(this).spGet("fps");a._spritely.instances[c]._stopped=!0;a._spritely.instances[c]._stopped_f1=b;a._spritely.instances[c]["type"]=="sprite"&&a(this).spSet("fps",0);if(b){var d=a._spritely.getBgY(a(this));a(this).css("background-position","0 "+d)}});return this},spStart:function(){a(this).each(function(){var b=a(this).attr("id"),c=a._spritely.instances[b]._last_fps||12;a._spritely.instances[b]._stopped=!1;a._spritely.instances[b]["type"]=="sprite"&&a(this).spSet("fps",c)});return this},spToggle:function(){var b=a(this).attr("id"),c=a._spritely.instances[b]._stopped||!1,d=a._spritely.instances[b]._stopped_f1||!1;c?a(this).spStart():a(this).spStop(d);return this},fps:function(b){a(this).each(function(){a(this).spSet("fps",b)});return this},spSpeed:function(b){a(this).each(function(){a(this).spSet("speed",b)});return this},spRelSpeed:function(b){a(this).each(function(){var c=a(this).spGet("depth")/100;a(this).spSet("speed",b*c)});return this},spChangeDir:function(b){a(this).each(function(){a(this).spSet("dir",b)});return this},spState:function(b){a(this).each(function(){var c=(b-1)*a(this).height()+"px",d=a._spritely.getBgX(a(this)),e=d+" -"+c;a(this).css("background-position",e)});return this},lockTo:function(b,c){a(this).each(function(){var d=a(this).attr("id");if(!a._spritely.instances[d])return this;a._spritely.instances[d].locked_el=a(this);a._spritely.instances[d].lock_to=a(b);a._spritely.instances[d].lock_to_options=c;window.setInterval(function(){if(a._spritely.instances[d].lock_to){var b=a._spritely.instances[d].locked_el,c=a._spritely.instances[d].lock_to,e=a._spritely.instances[d].lock_to_options,f=e.bg_img_width,g=c.height(),h=a._spritely.getBgY(c),i=a._spritely.getBgX(c),j=parseInt(i)+parseInt(e.left),k=parseInt(h)+parseInt(e.top);j=a._spritely.get_rel_pos(j,f);a(b).css({top:k+"px",left:j+"px"})}},c.interval||20)});return this},destroy:function(){var b=a(this),c=a(this).attr("id");delete a._spritely.instances[c];return this}})})(jQuery);try{document.execCommand("BackgroundImageCache",!1,!0)}catch(err){};