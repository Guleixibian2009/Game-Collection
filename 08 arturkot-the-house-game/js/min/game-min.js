var game={room:function(a,b){room.generate({inject:"room",grid_width:13,grid_height:19,collision_nodes:["7-9","0-14","0-15","1-15","1-14","0-4","0-5","0-6","0-7","0-8","0-9","1-4","1-5","1-6","1-7","1-8","1-9","2-4","2-5","2-6","2-7","2-8","2-9","11-7","11-8","11-9","11-10","12-7","12-8","12-9","12-10","10-1"],drag_room:!0,room_glow:!0,player:"player",player_speed:100,player_position_x:a,player_position_y:b,volume:50,execute:function(){if($.inArray("scene_intro",played)===-1){var a=$.jStorage.get("played");a.push("scene_intro");$.jStorage.set("played",a);$("#player").text_cloud("Where am I?",2e3)}room.transparency($("#chair"),$("#6-9, #6-8, #7-8, #5-8, #5-7, #4-6, #4-7"));room.transparency($("#bed, #bed_mask"),$("#2-3, #1-3, #0-3, #1-2, #0-2"));room.transparency($("#desk, #desk_mask"),$("#12-6, #11-5, #11-6, #10-10, #10-9, #10-8, #10-7, #10-6, #10-5, #9-9, #9-8, #9-7, #9-6, #9-5"));room.transparency($("#shelf, #shelf_mask"),$("#1-13, #0-13, #0-12"));room.transparency($("#plant"),$("#9-1, #9-0, #10-0"));room.pulse($("#glow"),5e3);$("#window, #door_exit, #plant_check").tooltip("left");$("#the_game").find("#note").tooltip("right");$("#water, #picture").tooltip("right");$("#bubbles").sprite({fps:8,no_of_frames:8});$("#window").click(function(){room.the_player.go_to.start({target:"5-0",action:function(){view.start([["aquarium_view","3000","10"],["boiler_room_view","5000","4"],["corridor_view","4000","8"]],function(){if($.inArray("scene_furnace",played)!==-1){$("#corridor_view").addClass("leaves");var a=$("#boiler_room_view"),b=$('<div class="smoke one" />').appendTo(a),c=$('<div class="smoke two" />').appendTo(a),d=$('<div class="smoke tri" />').appendTo(a),e=function(a){a.css("opacity","1").transition({x:-50,y:-100,scale:3,opacity:0},5e3,"in-out",function(){a.transition({x:0,y:0,scale:1},(Math.random()*5+1)*100,function(){e(a)})})};e(b);setTimeout(function(){e(c)},1e3);setTimeout(function(){e(d)},2e3)}})}})});$("#the_game").find("#note").click(function(){room.the_player.go_to.start({target:"10-8",action:function(){items.take("#note")}})});if($.inArray("scene_furnace",played)!==-1){$("#picture_winter").css("background","none");$("#plant").removeClass("small")}$("#door_exit").click(function(){room.the_player.go_to.start({target:"6-18",action:function(){if($.inArray("key",collected)===-1){sound_door_locked.play();$("#player").text_cloud("Locked!",1e3)}else if($.inArray("key",used)===-1){items.use("#key");$("#option_0").click(function(){dialogue_box.destroy();sound_door.play();game.corridor(14,0)})}else{sound_door.play();game.corridor(14,0)}}})});$("#water").click(function(){room.the_player.go_to.start({target:"2-15",action:function(){if($.inArray("key",collected)===-1){scene.no_click(!0);room.center(!0,2e3);$(room.player_body()).css("background-position","-310px 0").animate({opacity:0},2e3);$("#player").text_cloud("This aquarium is... Strange",1500);setTimeout(function(){scene.no_click(!1);sound_teleport.play();game.aquarium(20,5)},2e3)}else{sound_teleport.play();game.aquarium(20,5)}}})});$("#picture").click(function(){room.the_player.go_to.start({target:"3-6",action:function(){sound_teleport.play();$.inArray("scene_furnace",played)===-1?game.picture_snow(7,8):game.picture(7,8)}})})}})},aquarium:function(a,b){room.generate({inject:"aquarium",grid_width:23,grid_height:11,collision_nodes:["0-0","0-1","0-2","0-3","0-7","0-8","0-9","0-10","1-0","1-1","1-2","1-9","1-10","2-0","2-1","2-2","2-10","3-0","3-10","7-0","7-10","8-0","8-10","9-0","9-1","9-9","9-10","10-0","10-1","10-2","10-3","10-7","10-8","10-9","10-10","11-0","11-1","11-2","11-3","11-4","11-6","11-7","11-8","11-9","11-10","12-0","12-1","12-2","12-3","12-4","12-6","12-7","12-8","12-9","12-10","13-0","13-1","13-2","13-3","13-4","13-6","13-7","13-8","13-9","13-10","14-0","14-1","14-2","14-3","14-4","14-6","14-7","14-8","14-9","14-10","15-0","15-1","15-2","15-3","15-4","15-6","15-7","15-8","15-9","15-10","16-0","16-1","16-2","16-3","16-4","16-6","16-7","16-8","16-9","16-10","17-0","17-1","17-2","17-3","17-4","17-6","17-7","17-8","17-9","17-10","18-0","18-1","18-2","18-3","18-7","18-8","18-9","18-10","19-0","19-1","19-2","19-8","19-9","19-10","20-0","20-1","20-2","20-8","20-9","20-10","21-0","21-1","21-2","21-8","21-9","21-10","22-0","22-1","22-2","22-3","22-7","22-8","22-9","22-10","8-3","5-6","5-7","6-6","6-7","7-6","7-7","7-8","7-9","4-2","5-2","1-4","1-5","2-4","2-5","3-8","3-9"],drag_room:!0,player:"player",player_speed:100,player_position_x:a,player_position_y:b,volume:10,execute:function(){var a=$("#gate_left, #gate_right");room.transparency(a,$("#12-5, #11-5, #10-4, #10-5, #10-6, #9-2, #9-3, #9-4, #9-5, #9-6, #9-7, #8-1, #8-2, #8-4, #7-0, #7-1, #7-2, #6-0, #6-1"));room.transparency($("#rock_1"),$("#6-1, #6-2, #7-2"));room.transparency($("#rock_2"),$("#3-4, #4-5, #4-6, #5-5"));room.transparency($("#rock_3"),$("#3-1, #4-1, #4-2"));room.transparency($("#rock_4, #rock_4_mask"),$("#0-3, #0-4, #1-3"));room.transparency($("#rock_5"),$("#1-6, #2-6, #2-7, #3-7"));$("#the_game").find("#key").tooltip("left");$("#exit").tooltip("left");if($.inArray("key",collected)===-1){$("#teleport, #exit").hide();setTimeout(function(){$("#player").text_cloud("Teleport!? ...",2e3)},5e3)}$("#exit").hover(function(){$("#the_game").find("#teleport").find(".core").css({width:"140px",height:"140px",opacity:".3",margin:"-71px 0 0 -71px"})},function(){$("#the_game").find("#teleport").find(".core").css({width:"40px",height:"40px",opacity:".6",margin:"-21px 0 0 -21px"})}).click(function(){room.the_player.go_to.start({target:"20-5",action:function(){sound_teleport.play();game.room(2,15)}})});npc.fish.swim()}})},picture:function(a,b){room.generate({inject:"picture",grid_width:11,grid_height:12,collision_nodes:["0-0","0-1","0-2","0-3","0-10","0-11","1-0","1-1","1-2","1-11","2-0","3-0","4-0","4-1","5-0","5-1","7-0","7-11","8-0","8-11","9-0","9-1","9-10","9-11","10-0","10-1","10-2","10-3","10-8","10-9","10-10","10-11"],drag_room:!0,room_glow:!0,player:"player",player_speed:100,player_position_x:a,player_position_y:b,volume:50,execute:function(){$("body").css("background","#fefeca");$("#gate, #exit").tooltip("right");$("#the_game").find("#exit").hover(function(){$("#the_game").find("#teleport").find(".core").css({width:"140px",height:"140px",opacity:".3",margin:"-71px 0 0 -71px"})},function(){$("#the_game").find("#teleport").find(".core").css({width:"40px",height:"40px",opacity:".6",margin:"-21px 0 0 -21px"})}).click(function(){room.the_player.go_to.start({target:"7-8",action:function(){sound_teleport.play();game.room(3,7)}})});$("#gate").click(function(){room.the_player.go_to.start({target:"0-6",action:function(){sound_teleport.play();game.fridge(5,2)}})})}})},picture_snow:function(a,b){room.generate({inject:"picture_snow",grid_width:11,grid_height:12,collision_nodes:["0-0","0-1","0-2","0-3","0-4","0-5","0-6","0-7","0-8","0-10","0-11","1-0","1-1","1-2","1-6","1-7","1-11","2-0","2-1","2-2","3-0","3-1","3-2","4-0","4-1","5-0","5-1","7-0","7-11","8-0","8-11","9-0","9-1","9-10","9-11","10-0","10-1","10-2","10-3","10-8","10-9","10-10","10-11"],drag_room:!0,room_glow:!0,player:"player",player_speed:100,player_position_x:a,player_position_y:b,volume:50,execute:function(){$("body").css("background","#cff3f3");var a=$("#the_game").find("#twig");$("#3-3, #the_game #twig").hover(function(){a.css("z-index","1000")},function(){a.css("z-index","1")});a.click(function(){room.the_player.go_to.start({target:"3-3",action:function(){items.take("#twig")}})});$("#the_game").find("#exit").hover(function(){$("#the_game").find("#teleport").find(".core").css({width:"140px",height:"140px",opacity:".3",margin:"-71px 0 0 -71px"})},function(){$("#the_game").find("#teleport").find(".core").css({width:"40px",height:"40px",opacity:".6",margin:"-21px 0 0 -21px"})}).click(function(){room.the_player.go_to.start({target:"7-8",action:function(){sound_teleport.play();game.room(3,7)}})});$("#exit, #the_game #twig").tooltip("left")}})},corridor:function(a,b){room.generate({inject:"corridor",grid_width:21,grid_height:7,collision_nodes:["8-0","8-1","9-0","9-1"],drag_room:!0,room_glow:!0,player:"player",player_speed:100,player_position_x:a,player_position_y:b,volume:100,execute:function(){scene.corridor();room.transparency($("#phone, #phone_mask"),$("#6-0, #7-0, #7-1"));room.transparency($("#handrail"),$("#0-6, #1-6, #2-6, #3-6, #4-6, #0-5, #1-5, #2-5, #3-5, #0-4, #1-4, #2-4"));room.pulse($("#glow"),5e3);$("#door_room, #door_kitchen, #door_toilet, #door_bathroom, #phone_use, #stairs").tooltip("left");$("#door_big_room, #window").tooltip("right");var a=function(){$("#door_hidden_corridor").click(function(){room.the_player.go_to.start({target:"9-0",action:function(){game.hidden_corridor(1,18)}})})};if($.inArray("scene_corridor_phone",played)!==-1){$("#phone, #phone_mask, #phone_shadow").remove();room.settings.collision_nodes=[];$("#8-0, #8-1, #9-0, #9-1").removeClass("collision");$("#hidden_door").css("height","246px");$('<div id="door_hidden_corridor" data-tooltip="Go to the corridor" />').appendTo("#corridor").tooltip("left")}else $("#phone_use").click(function(){room.the_player.go_to.start({target:"8-2",action:function(){$("#phone_use").remove();scene.corridor_phone();room.settings.collision_nodes=[];$("#8-0, #8-1, #9-0, #9-1").removeClass("collision");$('<div id="door_hidden_corridor" data-tooltip="Go to the corridor" />').appendTo("#corridor").tooltip("left");a()}})});$("#window").click(function(){room.the_player.go_to.start({target:"0-2",action:function(){view.start([["start_room_view","3000","10"],["aquarium_view","2700","-8"],["picture_snow","3000","-2"]],function(){$("#window_middle").remove();$.inArray("scene_furnace",played)!==-1&&$("#picture_snow").addClass("no_snow")})}})});var b=function(){$("#door_kitchen").remove();$("#true_form, #true_form_2, #true_form_3").css("opacity",1)};if($.inArray("scene_furnace",played)!==-1&&$.inArray("scene_corridor_phone",played)===-1){b();room.settings.collision_nodes=["5-0","5-1","8-0","8-1","9-0","9-1"];$("#5-0, #5-1, #8-0, #8-1, #9-0, #9-1").addClass("collision")}else if($.inArray("scene_furnace",played)!==-1){b();room.settings.collision_nodes=["5-0","5-1"];$("#5-0, #5-1").addClass("collision")}$("#door_room").click(function(){room.the_player.go_to.start({target:"14-0",action:function(){sound_door.play();game.room(6,18)}})});a();$("#door_kitchen").click(function(){room.the_player.go_to.start({target:"4-0",action:function(){sound_door.play();game.kitchen(4,18)}})});$("#door_toilet").click(function(){room.the_player.go_to.start({target:"11-6",action:function(){sound_door.play();game.toilet(2,0)}})});$("#door_bathroom").click(function(){room.the_player.go_to.start({target:"18-6",action:function(){sound_door.play();game.bathroom(5,0)}})});var c=$("#lightbox"),d=$("#keypad");$("#door_big_room").click(function(){room.the_player.go_to.start({target:"20-3",action:function(){if($.inArray("scene_keypad",played)===-1)c.fadeIn().load("keypad.html",function(){var a=[],b=function(){$("#keypad").remove();c.fadeOut()};if(window.turned_on==="on"){$("#keypad").removeClass("off").addClass("on");$("input").click(function(){a.push($(this).val());sound_button.play();if(a.length===6&&a.join("")==="854269"){sound_beep.play();$("#keypad").find(".on").css("box-shadow","none");$("#keypad").find(".on").append('<div class="pass" />');setTimeout(function(){var a=$.jStorage.get("played");a.push("scene_keypad");$.jStorage.set("played",a);b();sound_door.play();game.big_room(0,6)},500)}else if(a.length===6){a=[];sound_wrong.play();$("#keypad").find(".on").animate({opacity:.5},200).animate({opacity:1},200).animate({opacity:.5},200).animate({opacity:1},200)}return!1})}else $("input").click(function(){return!1});c.on("click",".close",function(){b();window.turned_on!=="on"&&$.jStorage.get("is_in")==="corridor"&&$("#player").text_cloud("Looks like it's turned off.",2e3)})});else{sound_door.play();game.big_room(0,6)}}})});$("#stairs").on("click",function(){room.the_player.go_to.start({target:"6-6",action:function(){if($.inArray("scene_void_shower",played)===-1){$("#sprite").css("background-position","-620px 0");scene.no_click(!0,"rgba(0, 0, 0, .3)");$("#settings, #button, #switch_sound").addClass("dim");$("#player").text_cloud("I... I don't think it's a good idea to go there.",2e3);setTimeout(function(){dialogue_box.display({character:!1,picture:!1,text:"Would you like to step into the darkness?",options:["Ok","No!"]},"small");$("#options").on("click","#option_1",function(){$("#settings, #button, #switch_sound").removeClass("dim");dialogue_box.destroy()});$("#options").on("click","#option_0",function(){setTimeout(function(){$("#settings, #button, #switch_sound").removeClass("dim");scene.no_click(!1)},1e3);game.void(11,11)})},2e3)}else{$("#sprite").css("background-position","-620px 0");$("#player").text_cloud("There's NO WAY I'm going there!",2e3)}}})})}})},hidden_corridor:function(a,b){room.generate({inject:"hidden_corridor",grid_width:3,grid_height:19,collision_nodes:["1-0"],drag_room:!0,room_glow:!0,player:"player",player_speed:100,player_position_x:a,player_position_y:b,volume:50,execute:function(){function h(){window.timer_discharge=setTimeout(function(){$(g).css("opacity",1);sound_buzz.play();window.timer_discharge=setTimeout(function(){soundManager.stop("sound_buzz");$(g).css("opacity",0);h()},(Math.random()*5+1)*100)},(Math.random()*4+1)*1e3)}var a=$("#switch_use"),b=$("#door_corridor"),c=$("#peephole_use");b.tooltip("left");a.tooltip("left");c.tooltip("right");var d=$("#spot"),e=$("#peephole"),f=$("#player");clearInterval(window.timer_light);clearInterval(window.timer_discharge);window.timer_light=setInterval(function(){var a=$(f).css("z-index");if(a==="10"||a==="12"||a==="14"||a==="29"||a==="33"){$(d).css("opacity",.6);$(e).css("opacity",.8)}else if(a==="31"){$(d).css("opacity",.4);$(e).css("opacity",.6)}else if(a==="50"){$(d).css("opacity",.2);$(e).css("opacity",.4)}else{$(d).css("opacity",1);$(e).css("opacity",1)}},100);var g=$("#discharge");$(g).sprite({no_of_frames:3});h();var i=$("#switch"),j=23;window.turned_on=window.turned_on==="on"?"on":"off";window.turned_on==="on"&&i.css("background-position","0 -71px");$(a).click(function(){window.turned_on==="off"&&room.the_player.go_to.start({target:"1-1",action:function(){sound_switch.play();i.css("background-position","0 -71px");window.turned_on="on";var b=1,c=$('<div id="indicator">22</div>').appendTo("body");window.timer_counter=setInterval(function(){console.log("counting...");b++;a.attr("data-tooltip",j-b+" seconds remaining");c.text(j-b)},1e3);window.timer_switch=setTimeout(function(){a.attr("data-tooltip","Use the switch");window.turned_on="off";sound_switch.play();$("#switch").css("background-position","0 0");c.remove();console.log("time out");clearInterval(window.timer_counter);$("#keypad").remove();$("#lightbox").fadeOut()},j*1e3)}})});b.click(function(){room.the_player.go_to.start({target:"1-18",action:function(){clearInterval(window.timer_light);clearInterval(window.timer_discharge);game.corridor(9,0);setTimeout(function(){scene.explosion()},2e3)}})});c.click(function(){room.the_player.go_to.start({target:"2-6",action:function(){f.find("#sprite").css("background-position","-930px 0");$("<div/>",{id:"white"}).appendTo("body").css("opacity","0").animate({opacity:1},1e3,function(){clearInterval(window.timer_light);clearInterval(window.timer_discharge);setTimeout(function(){$("#white").animate({opacity:0},500,function(){$("#white").remove()});$.inArray("scene_outside",played)===-1?scene.fish_unite(!0):scene.fish_unite()},500)})}})})}})},kitchen_true:function(a,b){room.generate({inject:"kitchen_true",grid_width:9,grid_height:19,collision_nodes:["0-1","0-2","0-3","0-4","0-5","0-6","0-7","0-8","0-9","0-10","0-11","0-12","0-13","0-14","0-15","0-16","0-17","1-2","1-3","1-4","1-5","1-6","1-7","1-8","1-9","1-10","1-11","1-12","1-13","1-14","1-15","1-16","1-17","5-10","5-11","6-7","6-8","6-9","6-10","6-11","6-12","7-0","7-1","7-2","7-5","7-6","7-7","7-8","7-9","7-10","7-11","7-12","7-13","7-14","7-15","7-16","7-17","7-18","8-0","8-1","8-2","8-5","8-6","8-7","8-8","8-9","8-10","8-11","8-12","8-13","8-14","8-15","8-16","8-17","8-18"],drag_room:!0,room_glow:!0,player:"player",player_speed:100,player_position_x:a,player_position_y:b,volume:50,execute:function(){room.transparency($("#fridge"),$("#6-1, #5-0"));room.transparency($("#table, #table_mask"),$("#4-3, #4-4, #4-5, #4-6, #4-7, #4-8, #5-4, #5-5, #5-6, #5-7, #5-8, #5-9, #6-4, #6-5, #6-6"));room.transparency($("#branches"),$("#6-15, #6-14, #6-13, #5-14, #5-13, #5-12, #5-11, #4-12, #4-11, #4-10, #3-11, #3-10, #3-8, #3-7, #3-6, #3-5, #2-10, #2-9, #2-4, #2-5, #2-6, #1-4, #1-5"));room.pulse($("#glow"),5e3);var a=$("#the_green_guy");$("#fridge_use").tooltip("left");a.tooltip("right");var b=$("#table"),c=$("#eye");if($.inArray("scene_computer",played)!==-1){window.eye=setInterval(function(){c.sprite({no_of_frames:5,play_frames:5})},(Math.random()*10+1)*1e3);a.remove();setTimeout(function(){if($.inArray("scene_unite",played)===-1||$.inArray("scene_outside",played)===-1){b.text_cloud("You're not ready yet",2e3);setTimeout(function(){b.text_cloud("You have to be at least partially complete to travel...",2e3)},3500)}else{scene.no_click(!0,"rgba(0,0,0,.1)");b.text_cloud("You're ready. You can go now...",5e3);setTimeout(function(){room.the_player.go_to.start({target:"3-4",action:function(){$("#sprite").css("background-position","-620px 0");$("#player").text_cloud("But... Where?",2e3);setTimeout(function(){b.text_cloud("To meet with yourself.",4e3);sound_woosh.play({volume:120});$("#light").animate({opacity:1},500,function(){$("#player").css("opacity",0);$("#faux-player").css("opacity",1).sprite({no_of_frames:5,play_frames:5}).animate({top:"-=50px"},500).animate({top:-233,right:65,opacity:0},500,function(){var a=$(this);a.appendTo("body").css({opacity:0,left:"50%",top:"50%",margin:"-155px 0 0 -155px",backgroundPostion:"0 -310px"}).delay(2e3).animate({opacity:1},500);a.addClass("levitate");setTimeout(function(){soundManager.stopAll();sound_train.play();a.spState(2).spStop(!0).sprite({no_of_frames:5,play_frames:5}).spStart().animate({opacity:0},2e3,function(){scene.cabin()})},5e3);$("#kitchen_true").animate({opacity:0},500)})})},2500)}})},5e3)}},1e3)}else c.remove();$("#fridge_use").click(function(){room.the_player.go_to.start({target:"7-3",action:function(){clearInterval(window.eye);sound_teleport.play();game.fridge(0,2)}})})}})},kitchen:function(a,b){room.generate({inject:"kitchen",grid_width:9,grid_height:19,collision_nodes:["0-3","0-4","0-5","0-6","0-7","0-8","0-9","0-10","0-11","0-12","0-13","0-14","0-15","0-16","1-3","1-4","1-5","1-6","1-7","1-8","1-9","1-10","1-11","1-12","1-13","1-14","1-15","1-16","6-7","6-8","6-9","6-10","7-5","7-6","7-7","7-8","7-9","7-10","8-7","8-8","8-9","8-10","7-0","7-1","7-2","8-0","8-1","8-2"],drag_room:!0,room_glow:!0,player:"player",player_speed:100,player_position_x:a,player_position_y:b,volume:50,execute:function(){room.transparency($("#cupboard, #cupboard_mask"),$("#0-1, #0-2, #1-2"));room.transparency($("#table, #table_mask, #chair"),$("#4-5, #4-6, #4-7, #4-8, #5-4, #5-5, #5-6, #5-7, #5-8, #5-9, #6-4, #6-5, #6-6"));room.transparency($("#fridge"),$("#5-0, #6-0, #6-1"));room.pulse($("#glow"),5e3);$("#door_kitchen").tooltip("left");$("#window").tooltip("left");$("#window").click(function(){room.the_player.go_to.start({target:"2-0",action:function(){view.start([["big_room_view","5000","5"],["start_room_view",3e3,-3],["bathroom_view",1589,-2]],function(){if($.inArray("scene_explosion",played)===-1){$("#big_room_view").append('<div id="building" />').append('<div id="baloon" />');var a=function(){$("#baloon").transition({rotate:-1,y:-5},2e3).transition({rotate:1.5,y:5},2200,function(){a()})};a()}else $("#big_room_view").addClass("explosion")})}})});$("#kitchen_use_1, #kitchen_use_2, #kitchen_use_3").click(function(){$("#kitchen_kitchen_true").css("opacity",".3");var a=$("#kitchen");a.css("rotate","1");setTimeout(function(){a.css("rotate","-1")},100);setTimeout(function(){a.css("rotate","0")},100);setTimeout(function(){$("#kitchen_kitchen_true").css("opacity","0")},100)});$("#door_kitchen").click(function(){room.the_player.go_to.start({target:"4-18",action:function(){sound_door.play();game.corridor(4,0)}})})}})},toilet:function(a,b){room.generate({inject:"toilet",grid_width:5,grid_height:5,collision_nodes:["2-4","2-3"],drag_room:!0,player:"player",player_speed:100,player_position_x:a,player_position_y:b,volume:150,execute:function(){var a=$("#door_corridor"),b=$("#cord"),c=$("#cord_use");room.transparency($("#wc, #cord"),$("#0-3, #0-2, #1-4, #1-3, #1-2"));c.tooltip("left");a.tooltip("left");c.click(function(){room.the_player.go_to.start({target:"1-3",action:function(){sound_creak.play();b.css("top",-88);$("#sprite").css("background-position","-620px 0px");setTimeout(function(){b.css("top",-108)},900);setTimeout(function(){sound_teleport.play();game.boiler_room(8,0)},2e3)}})});a.click(function(){room.the_player.go_to.start({target:"2-0",action:function(){sound_door.play();game.corridor(11,6)}})})}})},bathroom_setup:function(){room.transparency($("#bathtube"),$("#3-2, #3-3, #3-4, #3-5, #3-6, #3-7, #4-2, #4-3, #4-4, #4-5, #4-6, #4-7, #4-8, #5-2, #5-3, #6-2, #6-3, #7-3"));$("#door_corridor").click(function(){room.the_player.go_to.start({target:"5-0",action:function(){sound_door.play();game.corridor(18,6)}})});$("#mirror").click(function(){room.the_player.go_to.start({target:"3-2",action:function(){$("#sprite").css("background-position","-310px 0");setTimeout(scene.mirror,200)}})});if($.inArray("scene_shower",played)!==-1){$("#curtain").css("opacity",0);$("#curtain_folded").css("opacity",1);$("#curtain_use").css("cursor","move")}else $("#curtain_use").click(function(){room.the_player.go_to.start({target:"0-7",action:function(){scene.bathroom_shower()}})});$("#window_use").click(function(){room.the_player.go_to.start({target:"3-8",action:function(){view.start([["big_room_view",5e3,7],["start_room_view",3e3,-5],["kitchen_view",2365,-2]],function(){$("#window_middle").css("left","40%");if($.inArray("scene_explosion",played)===-1){$("#big_room_view").append('<div id="building" />').append('<div id="baloon" />');var a=function(){$("#baloon").transition({rotate:-1,y:-7},2e3).transition({rotate:1.5,y:7},2200,function(){a()})};a()}else $("#big_room_view").addClass("explosion");$.inArray("scene_furnace",played)!==-1&&$("#kitchen_view").addClass("true")})}})})},bathroom:function(a,b){room.generate({inject:"bathroom",grid_width:8,grid_height:9,collision_nodes:["0-0","0-1","0-2","0-3","0-4","0-5","1-0","1-1","1-2","1-3","1-4","1-5","2-1","2-2","2-3","5-4","5-5","5-6","5-7","5-8","6-4","6-5","6-6","6-7","6-8","7-4","7-5","7-6","7-7","7-8"],drag_room:!0,player:"player",player_speed:100,player_position_x:a,player_position_y:b,volume:50,execute:function(){game.bathroom_setup()}})},big_room:function(a,b){room.generate({inject:"big_room",grid_width:8,grid_height:19,collision_nodes:["0-0","0-1","0-2","0-3","0-13","0-14","0-15","0-16","1-0","1-13","1-14","1-15","1-16","2-0","2-13","2-14","2-15","3-0","4-0","4-14","7-0","7-3"],drag_room:!0,player:"player",player_speed:100,player_position_x:a,player_position_y:b,volume:0,execute:function(){room.transparency($("#pillar"),$("#4-1, #5-1, #5-2, #6-2, #6-3"));room.transparency($("#computer, #computer_mask"),$("#0-11, #0-12, #1-12"));room.transparency($("#chair"),$("#2-11, #2-12, #2-13, #3-12, #3-13, #3-14, #4-13"));$("#computer_use, #door_corridor, #window_use").tooltip("right");$("#door_corridor").click(function(){room.the_player.go_to.start({target:"0-6",action:function(){sound_door.play();game.corridor(20,3)}})});$("#window_use").click(function(){room.the_player.go_to.start({target:"7-9",action:function(){view.start([["kitchen_view","3000","2"],["toilet_view","6000","2"],["fridge_view","6000","1"]],function(){$.inArray("scene_furnace",played)!==-1&&$("#kitchen_view").addClass("true")})}})});var a=$("#computer_mask").add("#computer");if($.inArray("scene_computer",played)!==-1){a.addClass("off");$("#computer_use").attr("data-tooltip","It doesn't work anymore...").css("cursor","help")}$("#computer_use").click(function(){if($.inArray("scene_computer",played)!==-1)return!1;room.the_player.go_to.start({target:"3-14",action:function(){var b=$("#lightbox"),c=$('<div id="computer_screen" />').appendTo(b);$("div.close")===-1&&b.append('<div class="close" />');b.fadeIn();var d=$('<div id="noise_1" />').appendTo(c),e=$('<div id="noise_2" />').appendTo(c);c.append('<span id="completion">completion: <span class="progress one"></span><span class="progress two"></span><span class="progress"></span></span>');c.append('<div class="eye" />');if($.inArray("scene_furnace",played)===-1){c.css("background","#111 url(images/big_room_kitchen.jpg) 50% 50% no-repeat");c.append('<span id="status">status: hidden</span>')}else{c.css("background","#111 url(images/big_room_kitchen_true.jpg) 50% 50% no-repeat");c.append('<span id="status">status: revealed<br /> <span class="question">activate?</span> <span class="cursor"></span></span>')}$.inArray("scene_unite",played)!==-1&&$.inArray("scene_outside",played)!==-1?c.find("span.one, span.two").css("background","#6add04"):($.inArray("scene_unite",played)!==-1||$.inArray("scene_outside",played)!==-1)&&c.find("span.one").css("background","#6add04");var f=function(){d.css("opacity",0);e.css("opacity",1);window.computer_distortions=setTimeout(function(){d.css("opacity",1);e.css("opacity",0);window.computer_distortions=setTimeout(function(){f()},100)},100)},g=function(){c.find(".cursor").css("opacity",0);window.computer_distortions=setTimeout(function(){c.find(".cursor").css("opacity",1);window.computer_distortions=setTimeout(function(){g()},1e3)},1e3)};f();g();var h=function(){var d=$.jStorage.get("played");d.push("scene_computer");$.jStorage.set("played",d);a.addClass("off");$("#computer_use").attr("data-tooltip","It doesn't work anymore...").css("cursor","help");$("#status").text("]awe[∑ĽfWńĶ•");setTimeout(function(){$("#status").text("√®ńę©wweras")},500);setTimeout(function(){$("#status").text("")},1500);c.find("div.eye").animate({height:5},function(){c.text_cloud("I'm waiting...",2e3);setTimeout(function(){clearInterval(window.computer_distortions);c.empty().css("background","#000");b.fadeOut()},2500)})};$("#status").find("span.question, span.cursor").click(function(){$("#status").find("span.question, span.cursor").off();h()});$("div.close").click(function(){c.remove();clearInterval(window.computer_distortions);b.fadeOut()})}})})}})},boiler_room:function(a,b){room.generate({inject:"boiler_room",grid_width:12,grid_height:12,collision_nodes:["0-4","0-5","0-6","0-7","1-4","1-5","1-6","1-7","2-4","2-5","2-6","2-7","2-8","3-4","3-5","3-6","3-7","7-9","7-10","7-11","8-8","8-9","8-10","8-11","9-8","9-9","9-10","9-11","10-8","10-9","10-10","10-11","11-8","11-9","11-10","11-11"],drag_room:!0,player:"player",player_speed:100,player_position_x:a,player_position_y:b,volume:50,zdetection:function(){return $("#player").attr("data-y")>7?100:!1},execute:function(){soundManager.pause("boiler_room");room.transparency($("#furnace"),$("#0-0, #0-1, #0-2, #0-3, #1-1, #1-2, #1-3, #2-2, #2-3, #3-3"));var a=$("#furnace_use"),b=$("#body");a.tooltip("right");var c=$("#the_game").find("#coal");c.tooltip("left");c.click(function(){room.the_player.go_to.start({target:"7-8",action:function(){items.take("#coal")}})});var d=$("#door");d.tooltip("left");d.click(function(){room.the_player.go_to.start({target:"8-0",action:function(){clearInterval(window.timer);room.settings.zdetection=function(){};sound_teleport.play();game.toilet(1,3)}})});if($.inArray("scene_furnace",played)===-1)a.on("click",function(){room.the_player.go_to.start({target:"6-5",action:function(){$("#sprite").css("background-position","-310px 0");npc.furnace.is_weak()}})});else{npc.furnace.furnace_use().remove();npc.furnace.burn();b.css({rotate:"0deg",top:0});npc.furnace.random_moves();soundManager.resume("boiler_room")}}})},fridge:function(a,b){room.generate({inject:"fridge",grid_width:9,grid_height:6,collision_nodes:["0-1","0-4","0-5","3-0","4-5","5-5","6-0","6-5","7-0","7-2","7-5","8-0","8-1","8-2","8-3","8-5"],drag_room:!0,room_glow:!0,player:"player",player_speed:100,player_position_x:a,player_position_y:b,volume:50,execute:function(){$("body").css("background","#cff3f3");$("#entrance_use, #exit").tooltip("right");$("#the_game").find("#exit").hover(function(){$("#the_game").find("#teleport").find(".core").css({width:"140px",height:"140px",opacity:".3",margin:"-71px 0 0 -71px"})},function(){$("#the_game").find("#teleport").find(".core").css({width:"40px",height:"40px",opacity:".6",margin:"-21px 0 0 -21px"})}).click(function(){room.the_player.go_to.start({target:"5-2",action:function(){sound_teleport.play();game.picture(0,6)}})});if($.inArray("scene_unite",played)===-1){console.log("reday");$("#entrance, #entrance_use").hide();scene.release()}else $("#diamond").hide();$("#entrance_use").click(function(){room.the_player.go_to.start({target:"0-2",action:function(){sound_teleport.play();game.kitchen_true(7,3)}})})}})},train:function(a,b){room.generate({inject:"train",grid_width:15,grid_height:5,collision_nodes:["0-0","0-1","0-4","4-0","4-1","5-0","5-2","5-4","6-0","7-0","8-0","9-0","10-0","11-0","12-0","13-0","14-0","14-1","14-4","3-0"],drag_room:!0,player:"player",player_speed:100,player_position_x:a,player_position_y:b,volume:50,execute:function(){scene.no_click(!1);var a=$("#ticket_inspector");if($.inArray("darkness_retract3",played)!==-1){$("#exit_sky").remove();$("#use_train_door").on("click",function(){room.the_player.go_to.start({target:"2-0",action:function(){scene.no_click(!0,"rgba(0, 0, 0, .3)");$("#player").hide();$("#faux_player").show();setTimeout(function(){sound_sliding_door.play();$("#train_door").animate({left:153,top:-262},500,function(){sound_train_start.play();var a=$("#ring_2");a.removeClass("rotate");setTimeout(function(){a.addClass("rotate_faster")},100);$("#train").animate({left:$(window).width()/2-540,top:$(window).height()/2+30},2e3);setTimeout(function(){$("#train_glow").animate({opacity:1},500,function(){soundManager.stop("train");$("#settings, #button, #switch_sound").fadeOut();$("#train_container").animate({left:"-=5964px",top:"-=2580px"},1e3,function(){sound_ekg.play();$("#train_platform").fadeOut(2e3,function(){setTimeout(function(){$('<div id="ekg" />').appendTo("body").animate({width:$(window).width(),backgroundColor:"#31c116"},8200,"linear",function(){soundManager.stopAll();$("#ekg").fadeOut(4e3,function(){$.jStorage.flush();window.location.reload()})})},1e3)})})})},5e3)})},500)}})}).tooltip("left")}else $("#use_train_door").remove();if($.inArray("cabin_scene",played)===-1){setTimeout(function(){a.text_cloud("Good luck!",1e3)},1e3);setTimeout(function(){sound_sliding_door.play();$("#train_door").animate({left:153,top:-262},500);var a=$.jStorage.get("played");a.push("cabin_scene");$.jStorage.set("played",a)},2e3)}else $.inArray("darkness_retract3",played)!==-1?a.hide():$("#train_door").css({left:153,top:-262});$.inArray("darkness_retract3",played)!==-1&&$("#door_dark_corridor").remove();$("#door_dark_corridor").on("click",function(){room.the_player.go_to.start({target:"12-4",action:function(){game.last_corridor(0,4)}})})}})},last_corridor:function(a,b){room.generate({inject:"last_corridor",grid_width:5,grid_height:46,collision_nodes:[],drag_room:!0,player:"player",player_speed:100,player_position_x:a,player_position_y:b,volume:50,execute:function(){var a=$("#door_train"),b=$("#sprite"),c=$("#dark_player"),d=$("#darkness"),e=$("#lightbox_led").hide(),f=e.find(".close"),g=$("#use_led_1"),h=$("#use_led_2"),i=$("#use_led_3"),j=$("#fluorescent_2"),k=$("#fluorescent_3"),l=$("#fluorescent_4");a.add(g).add(h).add(i).tooltip("right");d.children("div").add(c).tooltip("left");a.on("click",function(){room.the_player.go_to.start({target:"0-4",action:function(){game.train(12,4)}})});setTimeout(function(){b.css("background-position","-620px 0");scene.darkness1()},100);var m=function(a,b,c,d,f){e.find(".light").removeClass("light");var g=$("#led_panel_body"),h=g.find("td.cell"),i=$("#led-r-l-l"),j=$("#led_clear");j.on("click",function(){sound_button.play();$(this).stop().animate({top:240},100).animate({top:235},100);h.add(i.find("td.cell")).removeClass("light")});var k=function(a,b){var c=a,d=a.closest("tr");thisX=parseInt(c.attr("class").split(" ")[1].split("-")[1],10),thisY=parseInt(d.attr("class").split("-")[1],10);return a.add(d.children("td.col-"+(thisX-1))).add(d.children("td.col-"+(thisX+1))).add(b.find("tr.row-"+(thisY-1)).children("td.col-"+thisX)).add(b.find("tr.row-"+(thisY+1)).children("td.col-"+thisX))},l=function(a,b){var c=a,d=a.
closest("tr");thisX=parseInt(c.attr("class").split(" ")[1].split("-")[1],10),thisY=parseInt(d.attr("class").split("-")[1],10);$target=b.find("tr.row-"+thisY).children("td.col-"+thisX);return $target.add(k($target,b))},m=function(a,b){for(var c=0,d=a.length;c<d;c++)b.find("tr.row-"+a[c][0]).children("td.col-"+a[c][1]).addClass("light")},n=function(a){var b=a.find(".light"),c=[];b.each(function(){var a=$(this),b=$(this).closest("tr");thisX=parseInt(a.attr("class").split(" ")[1].split("-")[1],10),thisY=parseInt(b.attr("class").split("-")[1],10);c.push([thisY,thisX])});return c},o=function(a,b){if(a.length!=b.length)return!1;var c=a.sort(),d=b.sort();for(var e=0;b[e];e++)if(c[e][0]!==d[e][0]||c[e][1]!==d[e][1])return!1;return!0};m(b,$("#led-r-u-l"));m(c,$("#led-r-u-r"));m(d,$("#led-r-l-r"));h.off().on("click",function(){sound_button.play();k($(this),g).add(l($(this),i)).toggleClass("light");o(n(g),a)&&f()}).on("mouseenter",function(){k($(this),g).addClass("highlight")}).on("mouseleave",function(){k($(this),g).removeClass("highlight")})},n=function(){g.off().attr("data-tooltip","It works now!").css("cursor","help").tooltip("right");$("#led_1").add(j).addClass("on");d.addClass("retract_1")};$.inArray("darkness_retract1",played)!==-1?n():g.on("click",function(){room.the_player.go_to.start({target:"0-9",action:function(){e.fadeIn();var a=[[1,1],[1,2],[1,3],[1,4],[1,5],[2,1],[2,3],[2,5],[3,1],[3,2],[3,3],[3,4],[3,5],[4,2],[4,4]],b=[[1,3],[1,4],[1,5],[2,2],[2,3],[2,5],[3,3],[3,4],[3,5],[4,2],[4,3],[4,5],[5,3],[5,4],[5,5]],c=[[2,2],[2,4],[3,1],[3,2],[3,3],[3,4],[3,5],[4,1],[4,3],[4,5],[5,1],[5,2],[5,3],[5,4],[5,5]],f=[[1,1],[1,2],[1,3],[2,1],[2,3],[2,4],[3,1],[3,2],[3,3],[4,1],[4,3],[4,4],[5,1],[5,2],[5,3]];m(a,b,c,f,function(){sound_beep.play();setTimeout(function(){var a=$.jStorage.get("played");a.push("darkness_retract1");$.jStorage.set("played",a);e.fadeOut(200);d.add(j).addClass("crawl");sound_darkness_retract.play();n()},1e3)})}})});var o=function(){h.off().attr("data-tooltip","It works now!").css("cursor","help").tooltip("right");$("#led_2").add(k).addClass("on");d.addClass("retract_2")};$.inArray("darkness_retract2",played)!==-1?o():h.on("click",function(){room.the_player.go_to.start({target:"0-21",action:function(){e.fadeIn();var a=[[2,2],[2,4],[4,2],[4,4]],b=[[2,2],[2,4],[4,2],[4,4]],c=[[2,2],[2,4],[4,2],[4,4]],f=[[2,2],[2,4],[4,2],[4,4]];m(a,b,c,f,function(){sound_beep.play();setTimeout(function(){var a=$.jStorage.get("played");a.push("darkness_retract2");$.jStorage.set("played",a);e.fadeOut(200);d.add(k).addClass("crawl");sound_darkness_retract.play();o();scene.darkness2()},1e3)})}})});var p=function(){i.off().attr("data-tooltip","It works now!").css("cursor","help").tooltip("right");$("#led_3").add(l).addClass("on");d.addClass("gone");scene.darkness3();setTimeout(function(){d.hide()},1e4)};if($.inArray("darkness_retract3",played)!==-1){p();var c=$("#dark_player");c.css("opacity",1)}else i.on("click",function(){room.the_player.go_to.start({target:"0-33",action:function(){e.fadeIn();var a=[[1,2],[2,4],[5,1],[4,5]],b=[[1,1],[2,5],[4,4],[5,2]],c=[[1,5],[2,1],[4,2],[5,4]],f=[[1,4],[2,2],[4,1],[5,5]];m(a,b,c,f,function(){sound_beep.play();setTimeout(function(){var a=$.jStorage.get("played");a.push("darkness_retract3");$.jStorage.set("played",a);e.fadeOut(200);d.add(l).addClass("crawl");sound_darkness_retract.play();p()},1e3)})}})});f.on("click",function(){e.fadeOut(200)})}})},"void":function(a,b){room.generate({inject:"void",grid_width:25,grid_height:25,drag_room:!0,player:"player",player_speed:100,player_position_x:a,player_position_y:b,volume:50,execute:function(){setTimeout(function(){var a=$("#player"),b=a.data("x"),c=a.data("y"),d=$("#"+b+"-"+c);sound_woosh.play();$("#door").add("#use_door").css({left:parseFloat(d.css("left"))-33,top:parseFloat(d.css("top"))-241}).fadeIn().end().css("z-index",d.data("z")-3);$("#use_door").on("click",function(){console.log(b+"-"+c);room.the_player.go_to.start({target:b+"-"+c,action:function(){setTimeout(function(){$("#sprite").css("-310px 0")},100);sound_teleport.play();game.void_bathroom(0,7)}})}).tooltip("right")},1e4)}})},void_bathroom:function(a,b){room.generate({inject:"void_bathroom",grid_width:8,grid_height:9,collision_nodes:["0-0","0-1","0-2","0-3","0-4","0-5","1-0","1-1","1-2","1-3","1-4","1-5","2-1","2-2","2-3","5-4","5-5","5-6","5-7","5-8","6-4","6-5","6-6","6-7","6-8","7-4","7-5","7-6","7-7","7-8"],drag_room:!0,player:"player",player_speed:100,player_position_x:a,player_position_y:b,volume:0,execute:function(){if($.inArray("scene_void_shower",played)===-1)scene.bathroom_void_shower();else{$("#faux_player").remove();game.bathroom_setup()}}})},exit:function(a,b){room.generate({inject:"exit",grid_width:6,grid_height:6,collision_nodes:["0-0","0-1","0-5","1-0","5-0"],drag_room:!0,player:"player",player_speed:100,player_position_x:a,player_position_y:b,volume:0,fade_color:"white",execute:function(){scene.no_click(!1);setTimeout(function(){$("#sprite").css("background-position","-620px 0")},100);$("body").prepend('<div id="exit_sky" />').css("background","#fff");var a=$("#use_exit"),b=$("#use_back");a.on("click",function(){room.the_player.go_to.start({target:"0-3",action:function(){game.train(14,3)}})}).tooltip("right");b.tooltip("left")}})}};soundManager.onready(function(){$("#the_game").load("intro.html",function(){function c(){$("#enter").animate({opacity:.5},a,function(){$(this).animate({opacity:1},a,function(){c()})})}function d(){$("#house").animate({top:"+=10px"},b,function(){$(this).animate({top:"-=10px"},b,function(){d()})})}$("#lightbox, #items, #switch_sound, #settings").hide();var a=500,b=2e3;c();d();var e=$('<div id="black" />').appendTo("body"),f=$('<div id="preloader" />').appendTo(e);e.css("opacity",1);$.preloadCssImages({statusBarEl:"#preloader"});$("#logo, #head_hole, #enter").click(function(){$("#head_hole, #head_back, #logo").fadeOut("500");$("#house").fadeOut("1000");$("#switch_sound, #settings").fadeIn();$("#lightbox").hide();is_in===""?scene.intro():is_in==="room"||is_in===""?game.room(5,6):is_in==="corridor"?game.corridor(17,3):is_in==="hidden_corridor"?game.hidden_corridor(1,18):is_in==="aquarium"?game.aquarium(20,5):is_in==="picture"?game.picture(5,5):is_in==="picture_snow"?game.picture_snow(7,8):is_in==="kitchen"?game.kitchen(4,10):is_in==="toilet"?game.toilet(2,2):is_in==="bathroom"?game.bathroom(4,4):is_in==="big_room"?game.big_room(4,4):is_in==="boiler_room"?game.boiler_room(9,5):is_in==="fridge"?game.fridge(5,2):is_in==="kitchen_true"?game.kitchen_true(5,2):is_in==="cabin"?scene.cabin():is_in==="train"?game.train(2,2):is_in==="last_corridor"?$.inArray("darkness_retract3",played)!==-1?game.last_corridor(2,36):game.last_corridor(0,6):is_in==="void"?game.void(11,11):is_in==="void_bathroom"?game.void_bathroom(0,7):is_in==="exit"&&game.exit(2,2);items.holder();settings.init()})})});