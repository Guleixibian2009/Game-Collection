var scene={intro:function(){$("#settings, #button, #switch_sound").addClass("dim");$("#intro").empty();$("<div/>",{id:"white"}).appendTo("#intro").animate({opacity:1},1e3,function(){$("<span/>",{id:"message_1","class":"message"}).appendTo("#intro").text("Hey!").hide().fadeIn(1e3,function(){$(this).fadeOut(2e3);$("<span/>",{id:"message_2","class":"message"}).appendTo("#intro").text("Hello!").hide().fadeIn(2e3,function(){$(this).fadeOut(2e3);$("<span/>",{id:"message_3","class":"message"}).appendTo("#intro").text("I hope he's alive...").hide().fadeIn(5e3).fadeOut(5e3);$("<span/>",{id:"message_4","class":"message player"}).appendTo("#intro").text("What?!").hide().fadeIn(500).fadeOut(5e3,function(){$("<span/>",{id:"message_5","class":"message player"}).appendTo("#intro").text("What's going on?!").hide().fadeIn(500).fadeOut(4e3,function(){$("#settings, #button, #switch_sound").removeClass("dim");game.room(5,6)})})})})})},corridor:function(){function e(){var e=$(window).width(),t=$(window).height();sound_scene_corridor.play();setTimeout(function(){$("#corridor").animate({left:e/2-150,top:t/2-744},5e3);$(room.player_body()).css("background-position","-620px 0")},1e3);setTimeout(function(){$("<span/>",{id:"message_1","class":"message"}).appendTo("#corridor").text("Come downstairs...").hide().fadeIn(1e3,function(){$(this).fadeOut(2e3);$("<span/>",{id:"message_2","class":"message"}).appendTo("#corridor").text("NOW!").hide().fadeIn(1e3,function(){$(this).fadeOut(2e3);$("<span/>",{id:"message_3","class":"message"}).appendTo("#corridor").text("Merge with me.").hide().fadeIn(1e3).fadeOut(2e3,function(){room.center(!0,5e3);var e=$.jStorage.get("played");e.push("scene_corridor");$.jStorage.set("played",e);setTimeout(function(){$("#settings, #button, #switch_sound").removeClass("dim");scene.no_click(!1)},5e3)})})})},6500)}if($.inArray("scene_corridor",played)===-1){$("#settings, #button, #switch_sound").addClass("dim");scene.no_click(!0);setTimeout(function(){e()},2e3)}},corridor_phone:function(){scene.no_click(!0);sound_scene_corridor_phone.play();var e=2e3,t=3500,n=1e4;$("#phone, #phone_mask, #phone_shadow").fadeOut(e);setTimeout(function(){$("#hidden_door").animate({height:246},n)},e+t);setTimeout(function(){var e=$.jStorage.get("played");e.push("scene_corridor_phone");$.jStorage.set("played",e);scene.no_click(!1)},e+t+n)},bathroom_shower:function(){sound_shower_curtain.play();sound_scary.play();room.the_player.go_to.start({target:"3-7"});setTimeout(function(){$("#player").text_cloud("WHAT the...!?",2e3);$("#sprite").css("background-position","-310px 0")},400);$("#curtain").css("opacity",0);$("#curtain_folded").css("opacity",1);$('<div id="dark_character" />').appendTo("#floor").sprite({no_of_frames:7}).delay(2e3).animate({opacity:0},500);$('<div id="bathroom_overlay" />').appendTo("#bathroom").animate({opacity:0},2500,"linear");setTimeout(function(){$("#curtain_use").remove();$("#dark_character, #bathroom_overlay").remove();soundManager.stop("sound_scary");var e=$.jStorage.get("played");e.push("scene_shower");$.jStorage.set("played",e)},2500)},mirror:function(){var e=$("#lightbox");e.fadeIn().load("bathroom_reflection.html",function(){var t=$("#reflection"),n=$("#reflection_flicker"),r=$("#reflection_glow");face=$("#face");var s=function(e,n,r){t.find(".first").hover(function(){$(this).children("div").css({opacity:"1"});var e=$(this);setTimeout(function(){e.next().children().css({opacity:"1"})},200)},function(){var e=$(this);setTimeout(function(){e.children().css({opacity:"0"})},2e3);setTimeout(function(){e.next().children().css({opacity:"0"})},3e3)})},o=function(e,t,n){width=e.width(),height=e.height(),tile_width=width/t,tile_height=height/n;for(i=0;i<width/tile_width;i++)for(j=0;j<width/tile_width;j++){$('<div id="'+i+"-"+j+'" class="ref_tile" />').attr("data-x",i).attr("data-y",j).appendTo(e).css({width:tile_width,height:tile_height,left:tile_width*i,top:tile_height*j}).append('<div class="first"><div>').append('<div class="second"><div>').children("div").children("div").css({"background-position":-i*tile_width+"px "+ -j*tile_height+"px"});i===width/tile_width-1&&j===width/tile_height-1&&s()}};o(face,10,10);var u=function(){window.timer=setTimeout(function(){n.css("opacity","1");window.timer=setTimeout(function(){n.css("opacity","0");u()},(Math.random()*1+1)*100)},(Math.random()*1+1)*100)},a=function(){window.timer=setTimeout(function(){face.css("-webkit-transform","rotate(.1deg)");window.timer=setTimeout(function(){face.css("-webkit-transform","rotate(-.1deg)");a()},(Math.random()*5+5)*100)},(Math.random()*5+5)*100)};a();u();e.on("click",".close",function(){t.remove();clearInterval(window.timer);e.fadeOut()})})},bathroom_void_shower:function(){scene.no_click(!0,"rgba(0, 0, 0, .3)");$("#settings, #button, #switch_sound").addClass("dim");game.bathroom_setup();var e=$("#player"),t=$("#sprite"),n=$("#bathroom"),r=$("#faux_player"),i=$('<div id="dark_character" />').appendTo("#floor").hide();setTimeout(function(){t.css("background-position","-310px 0");n.css({left:$(window).width()/2-100,top:$(window).height()/2-260});var s=$('<div id="bathroom_overlay" />').appendTo("#bathroom").css("z-index",1e3);r.text_cloud("!!!",1e3);setTimeout(function(){sound_screech2.play();r.css("background-image","url(images/void_merge.png)").sprite({fps:12,no_of_frames:12,play_frames:12}).delay(1e3).fadeOut(500);setTimeout(function(){s.animate({opacity:0},2500,"linear",function(){$(this).remove()})},1e3);setTimeout(function(){sound_shower_curtain.play();$("#curtain").css("opacity",0);$("#curtain_folded").css("opacity",1);room.the_player.go_to.start({target:"3-7",action:function(){e.text_cloud("WHAT the...!?",2e3);t.css("background-position","-310px 0")}})},500);i.sprite({no_of_frames:7}).delay(1e3).fadeIn(500).delay(1e3).fadeOut(500);setTimeout(function(){s.fadeOut(500);scene.no_click(!1);$("#settings, #button, #switch_sound").removeClass("dim");var e=$.jStorage.get("played");e.push("scene_void_shower");e.push("scene_shower");$.jStorage.set("played",e)},1e3)},1500)},100);if($.inArray("scene_computer",played)!==-1){$computer.addClass("off");$("#computer_use").attr("data-tooltip","It doesn't work anymore...").css("cursor","help")}},release:function(){var e=function(e,t){e.animate({left:$(window).width()/2,top:300},2e3);$("#opened").remove();t.find("#sprite").css("opacity",0).after('<div id="opened" />');$(".tile, #exit").css("display","none");window.repeat_wobble=!0;var n=function(e,t,r,i){if(!t)var t=4;if(!r)var r=500;e.transition({x:Math.random()*t+1,y:Math.random()*t+1},r).transition({x:3,y:-2},r,function(){i?n(e,t,r,i):window.repeat_wobble&&n(e,t,r,i)})};e.sprite({no_of_frames:4}).fps(8).spStop().spStart();n(e,100,1e3);n($("#opened"),4,500,!0);var r=$("#diamond"),i=function(){r.animate({opacity:0},500).animate({opacity:1},500,function(){i()})};i();r.text_cloud("It's coming!",1500);setTimeout(function(){e.text_cloud("Show me the way to him.",3e3)},4e3)},t=function(e,t){window.repeat_wobble=!1;scene.no_click(!0);room.center(!0,2e3);e.animate({left:$(window).width()/2-50,top:$(window).height()/2-150},2e3,function(){sound_woosh.play();$('<div id="flash" />').appendTo("#opened").transition({scale:40,opacity:.7},2e3).transition({scale:1e3,opacity:1},500,function(){e.remove();$("#opened").animate({opacity:0},1e3,function(){$(this).remove()});t.find("#sprite").animate({opacity:1},function(){scene.no_click(!1);$("#entrance, #entrance_use").fadeIn("slow");$("#diamond").hide();var e=$.jStorage.get("played");e.push("scene_unite");$.jStorage.set("played",e);t.text_cloud("I feel... Kind of... Better now.","2000")});$("div.tile, #exit").css("display","block")})})};setTimeout(function(){var n=$("#player"),r=$("#fridge"),i=r.offset(),s=i.top,o=!1,u=$('<div id="fly" />').appendTo("body");r.on("drag",function(t,i){var a=r.offset(),f=s-a.top;if(f<-700&&!o){o=!0;window.is_ready=!0;e(u,n)}}).on("dragstop",function(e,i){var o=r.offset(),a=s-o.top,f=n.offset();if(window.is_ready&&a>-300){window.is_ready=!1;t(u,n)}})},1e3)},fish_unite:function(e){var t=$("#the_game");$("body").css("background","#c2deeb");t.empty().load("outside_view.html",function(){$.inArray("scene_furnace",played)===-1&&$("#tree").removeClass("leaves");if(e){var t=$('<div id="outside_corridor" />').appendTo("#outside_view");t.append('<div id="switch" />').append('<div id="player_sprite" />').append('<div id="player_shadow" />');t.hide();var n=function(e,t,r,i){if(!t)var t=4;if(!r)var r=500;e.transition({x:Math.random()*t+1,y:Math.random()*t+1},r).transition({x:3,y:-2},r,function(){n(e,t,r,i)})},r=$("#fish");r.sprite({no_of_frames:5}).spState(2).fps(8).spStop().spStart();var i=function(e){e.animate({left:536,top:275},5e3,"linear",function(){e.spState(3)}).animate({left:328,top:395},5e3,"linear",function(){if(!window.test){e.spState(2);i(e)}})};i(r);setTimeout(function(){r.text_cloud("It's so nice outside!",2e3)},1e3);setTimeout(function(){r.stop(!0).animate({left:550,top:320},1e3,function(){r.spState(1).text_cloud("Thank you man!",2e3);t.fadeIn(1e3);$("#tree").fadeOut(1e3);$("body").animate({backgroundColor:"#000000"},1e3);n($("#player_sprite"),4,500);setTimeout(function(){r.animate({left:"+=100",top:"+=80"},700).animate({left:440,top:230},300);setTimeout(function(){sound_woosh.play();$('<div id="flash" />').appendTo(r).transition({scale:40,opacity:.7},2e3).transition({scale:100,opacity:1},500,function(){var e=$.jStorage.get("played");e.push("scene_outside");$.jStorage.set("played",e);setTimeout(function(){$("#player").text_cloud("What was that?!",2e3)},3e3);setTimeout(function(){$("#player").text_cloud("Was it real?",2e3)},8e3);game.hidden_corridor(2,6)})},850)},1500)})},5200)}else{$("#fish").remove();$('<div class="close" />').appendTo("body").click(function(){$(this).animate({opacity:0},500,function(){$(this).remove()});game.hidden_corridor(2,6)})}})},explosion:function(){if($.inArray("scene_explosion",played)===-1){scene.no_click(!0);sound_explosion.play();room.the_player.go_to.start({target:"5-1"});$("#the_game").children("div").animate({left:"-=5"},50).animate({left:"+=5",top:"-=10"},50).animate({left:"-=3",top:"+=4"},50).animate({left:"+=2",top:"-=6"},50).animate({left:"-=10",top:"-=6"},50).animate({left:"-=5"},50).animate({left:"+=5",top:"-=10"},50).animate({left:"-=3",top:"+=4"},50).animate({left:"+=2",top:"-=6"},50).animate({left:"-=10",top:"-=6"},50).animate({left:"-=5"},50).animate({left:"-=5",top:"+=10"},50).animate({left:"+=3",top:"-=4"},50).animate({left:"-=2",top:"+=6"},50).animate({left:"+=10",top:"+=6"},50).animate({left:"+=5"},50).animate({left:"-=5",top:"+=10"},50).animate({left:"+=3",top:"-=4"},50).animate({left:"-=2",top:"+=6"},50).animate({left:"+=10",top:"+=6"},50).animate({left:"-=4",top:"+=2"},50);setTimeout(function(){scene.no_click(!1);var e=$.jStorage.get("played");e.push("scene_explosion");$.jStorage.set("played",e)},1100)}},cabin:function(){$.jStorage.set("is_in","cabin");$("<div/>",{id:"black"}).appendTo("body").css("opacity",1).animate({opacity:0},2e3,function(){$("body").find("#black").remove()});$("#the_game").empty().load("cabin.html",function(){$("#cabin").pan({fps:30,speed:.2,dir:"right"});var e=$("#faux_player");setTimeout(function(){e.sprite({fps:4,no_of_frames:12,play_frames:4}).text_cloud("Huh?",500)},2e3);setTimeout(function(){var t=$("#ticket_inspector");t.sprite({fps:8,no_of_frames:8}).animate({opacity:1},200);t.animate({left:138,top:70},1e3,"linear",function(){$(this).spStop(!0).spState(2);setTimeout(function(){sound_sliding_door.play();$("#door").animate({left:-67,top:-40},500,function(){t.text_cloud("Your stop is next.",2e3);setTimeout(function(){t.text_cloud("You have to leave the train.",2e3)},2e3);setTimeout(function(){e.text_cloud("...",1e3)},1e3);setTimeout(function(){e.addClass("stand-up").sprite({fps:8,no_of_frames:12,play_frames:8});setTimeout(function(){t.spState(1).spStart().animate({left:-42,top:-30},1e3);setTimeout(function(){e.text_cloud("OK...",99999);t.animate({opacity:0},200);$("#cabin").animate({opacity:0},3e3,function(){game.train(2,2)})},800)},2500)},2e3)})},500)})},4e3)})},darkness1:function(){var e=function(){var e=$("#last_corridor"),t=$("#darkness").find(".text"),n=$("#settings, #button, #switch_sound"),r=$(window).width(),i=$(window).height();n.addClass("dim");scene.no_click(!0,"rgba(0, 0, 0, .3)");setTimeout(function(){e.animate({left:r/2-1e3,top:i/2-500},5e3,function(){sound_darkness.play();t.text("Fssssssss").animate({opacity:1},500);setTimeout(function(){t.animate({opacity:0},1e3);room.center(!0,5e3);setTimeout(function(){scene.no_click(!1);n.removeClass("dim");var e=$.jStorage.get("played");e.push("darkness1");$.jStorage.set("played",e)},5e3)},1e3)})},500)};$.inArray("darkness1",played)===-1&&e()},darkness2:function(){var e=function(){var e=$("#sprite"),t=$("#last_corridor"),n=$("#darkness").find(".text"),r=$("#settings, #button, #switch_sound"),i=$(window).width(),s=$(window).height();r.addClass("dim");scene.no_click(!0,"rgba(0, 0, 0, .3)");setTimeout(function(){e.css("background-position","-620px 0");setTimeout(function(){t.animate({left:i/2-800,top:s/2-1e3},5e3,function(){sound_darkness.play();n.text("Leave me alone!").animate({opacity:1},500);setTimeout(function(){n.animate({opacity:0},1e3);room.center(!0,5e3);setTimeout(function(){scene.no_click(!1);r.removeClass("dim")},5e3)},1e3)})},1e3)},500)};e()},darkness3:function(){var e=$("#dark_player");scene.no_click(!0,"rgba(0, 0, 0, .3)");sound_absorbing.play();setTimeout(function(){e.sprite({fps:4,no_of_frames:5,play_frames:5})},4e3);e.animate({opacity:1},5e3,function(){room.the_player.go_to.start({target:"2-40",action:function(){var e=$("#floor"),t=$("#player"),n=$("#dark_player"),r=$("#fluorescent_1, #fluorescent_2, #fluorescent_3, #fluorescent_4"),i=$('<div id="darkness_fill" />').appendTo(e).hide(),s=$('<div id="darkness_bg" />').appendTo(e).hide(),o=$('<div id="darkness_bg_light" />').appendTo(e).hide(),u=$('<div id="darkness_floor" />').appendTo(e).hide(),a=$('<div id="darkness_floor_light" />').appendTo(e).hide(),f=$('<div id="darkness_wires" />').appendTo(e).hide(),l=s.add(u).add(f);r.fadeOut();setTimeout(function(){l.add(i).delay(1e3).fadeIn(500,function(){s.transition({x:-10},1e4,"linear");f.transition({rotate:"10deg"},1e4,"linear");t.text_cloud("I guess I have no choice. I need to accept you.",4e3);n.text_cloud("I guess I have no choice. I need to accept you.",4e3);setTimeout(function(){t.text_cloud("But this time...",3e3);n.text_cloud("But this time...",3e3)},4e3);setTimeout(function(){t.text_cloud("I'll absorb you.",3e3)},8e3);l.delay(8e3).stop().transition({opacity:0},1e3);o.add(a).delay(8e3).fadeIn(1e3);setTimeout(function(){$("#no_click").css("background","transparent");n.fadeOut(1e3);sound_woosh.play();$('<div id="flash" />').appendTo(t).transition({scale:40,opacity:.7},2e3).transition({scale:100,opacity:1},500,function(){$("body").css("background","#fff");game.exit(3,3)})},13e3)})},1e3)}})})},no_click:function(e,t){e===!0?$("<div/>",{id:"no_click"}).appendTo("body").css("background",t):e===!1&&$("#no_click").remove()}};